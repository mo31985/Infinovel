(this.webpackJsonpinfinovel=this.webpackJsonpinfinovel||[]).push([[0],{16:function(e,t,n){e.exports=n(30)},25:function(e,t,n){},30:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),o=n(13),r=n.n(o),s=(n(25),n(9)),i=n(14),l=n(11),d=n(4);var u=function(){const[e,t]=Object(a.useState)(null),[n,o]=Object(a.useState)([]),[r,u]=Object(a.useState)(!1),[g,m]=Object(a.useState)("\u8f09\u5165\u4e2d..."),[b,h]=Object(a.useState)(null),[p,f]=Object(a.useState)(null),[x,y]=Object(a.useState)(!1),[w,O]=Object(a.useState)(null),[_,j]=Object(a.useState)(""),[E,I]=Object(a.useState)(""),[N,S]=Object(a.useState)(!1),[v,C]=Object(a.useState)(!1),[F,k]=Object(a.useState)({}),T={chapterId:"intro_chapter_1",title:"\u8ff7\u9727\u4e2d\u7684\u7dda\u7d22\uff1a\u502b\u6566\u7684\u84b8\u6c7d\u8207\u9b54\u6cd5",content:["\u5728\u7dad\u591a\u5229\u4e9e\u6642\u4ee3\u7684\u502b\u6566\uff0c\u84b8\u6c7d\u6a5f\u7684\u8f5f\u9cf4\u8072\u8207\u53e4\u8001\u9b54\u6cd5\u7684\u4f4e\u8a9e\u4ea4\u7e54\u3002\u9019\u500b\u57ce\u5e02\u65e2\u662f\u79d1\u6280\u7684\u5dd4\u5cf0\uff0c\u4e5f\u662f\u795e\u79d8\u4e8b\u4ef6\u7684\u6eab\u5e8a\u3002\u827e\u502b\u5075\u63a2\uff0c\u4e00\u4f4d\u4ee5\u654f\u92b3\u6d1e\u5bdf\u529b\u548c\u5c0d\u8d85\u81ea\u7136\u73fe\u8c61\u7684\u7368\u7279\u7406\u89e3\u800c\u805e\u540d\u7684\u79c1\u5bb6\u5075\u63a2\uff0c\u6b64\u6642\u6b63\u5750\u5728\u4ed6\u90a3\u9593\u7030\u6f2b\u8457\u7159\u8349\u5473\u7684\u8fa6\u516c\u5ba4\u88e1\u3002\u4ed6\u7684\u98a8\u8863\u642d\u5728\u6905\u80cc\u4e0a\uff0c\u684c\u4e0a\u5806\u6eff\u4e86\u672a\u89e3\u7684\u5377\u5b97\u548c\u4e00\u676f\u51b7\u6389\u7684\u7d05\u8336\u3002\u827e\u502b\u96d6\u7136\u6050\u9ad8\uff0c\u537b\u7e3d\u662f\u88ab\u6372\u5165\u8207\u9ad8\u8655\u76f8\u95dc\u7684\u6848\u4ef6\uff0c\u9019\u6210\u4e86\u4ed6\u8077\u696d\u751f\u6daf\u4e2d\u4e00\u500b\u5947\u7279\u7684\u8af7\u523a\u3002","\u7a97\u5916\uff0c\u502b\u6566\u7279\u5340\u6c38\u4e0d\u6563\u53bb\u7684\u84b8\u6c7d\u8ff7\u9727\u50cf\u4e00\u689d\u5de8\u9f8d\u822c\u76e4\u8e1e\uff0c\u541e\u566c\u8457\u5149\u7dda\u8207\u8072\u97f3\u3002\u4e00\u5c01\u7dca\u6025\u96fb\u5831\u6253\u7834\u4e86\u6e05\u6668\u7684\u5be7\u975c\uff0c\u96fb\u5831\u4f86\u81ea\u6cf0\u6664\u58eb\u6cb3\u7554\u7684\u7687\u5bb6\u79d1\u5b78\u9662\uff0c\u5167\u5bb9\u7c21\u6f54\u800c\u4ee4\u4eba\u4e0d\u5b89\uff1a\u8457\u540d\u767c\u660e\u5bb6\u7dad\u514b\u591a\xb7\u683c\u96f7\u68ee\u535a\u58eb\u96e2\u5947\u5931\u8e64\u4e86\u3002\u683c\u96f7\u68ee\u535a\u58eb\u4ee5\u5176\u5728\u300c\u6642\u9593\u6a5f\u68b0\u300d\u9818\u57df\u7684\u7a81\u7834\u6027\u7814\u7a76\u800c\u805e\u540d\uff0c\u4ed6\u7684\u5931\u8e64\u7121\u7591\u5c07\u5f15\u767c\u5de8\u5927\u6ce2\u703e\u3002","\u827e\u502b\u62b5\u9054\u683c\u96f7\u68ee\u535a\u58eb\u7684\u5be6\u9a57\u5ba4\uff0c\u90a3\u88e1\u4e00\u7247\u72fc\u85c9\uff0c\u7cbe\u5bc6\u9f52\u8f2a\u548c\u626d\u66f2\u7684\u96fb\u7dda\u6563\u843d\u4e00\u5730\uff0c\u7a7a\u6c23\u4e2d\u7030\u6f2b\u8457\u81ed\u6c27\u548c\u71d2\u7126\u91d1\u5c6c\u7684\u6c23\u5473\u3002\u9019\u4e0d\u662f\u666e\u901a\u7684\u5931\u7aca\uff0c\u66f4\u50cf\u662f\u4e00\u5834\u6df7\u4e82\u7684\u640f\u9b25\uff0c\u6216\u662f\u67d0\u7a2e\u5be6\u9a57\u5931\u63a7\u3002\u5728\u51cc\u4e82\u7684\u66f8\u684c\u4e0a\uff0c\u827e\u502b\u7684\u76ee\u5149\u88ab\u4e00\u5f35\u88ab\u58d3\u5728\u539a\u91cd\u6a5f\u68b0\u624b\u7a3f\u4e0b\u7684\u7d19\u689d\u5438\u5f15\u3002\u4e0a\u9762\u6f66\u8349\u5730\u5beb\u8457\u4e00\u884c\u5b57\uff1a\u300c\u6642\u9418\u5854\uff0c\u5348\u591c\uff0c\u7b49\u5f85\u3002\u300d\u5b57\u8de1\u626d\u66f2\uff0c\u4f3c\u4e4e\u5728\u6975\u5ea6\u6050\u61fc\u6216\u5009\u4fc3\u4e2d\u5beb\u4e0b\u3002","\u827e\u502b\u76ba\u8d77\u4e86\u7709\u982d\u3002\u6642\u9418\u5854\uff0c\u57ce\u5e02\u7684\u5730\u6a19\uff0c\u4e5f\u662f\u6642\u9593\u5b88\u8b77\u8005\u7d44\u7e54\u7684\u79d8\u5bc6\u64da\u9ede\u4e4b\u4e00\u3002\u9019\u5f35\u7d19\u689d\u662f\u683c\u96f7\u68ee\u535a\u58eb\u7559\u4e0b\u7684\u6700\u5f8c\u7dda\u7d22\u55ce\uff1f\u9084\u662f\u67d0\u7a2e\u7cbe\u5fc3\u8a2d\u8a08\u7684\u9677\u9631\uff1f\u4ed6\u5fc5\u9808\u505a\u51fa\u6c7a\u5b9a\uff0c\u9019\u5c07\u5f15\u5c0e\u4ed6\u8d70\u5411\u502b\u6566\u6700\u6df1\u8655\u7684\u79d8\u5bc6\u3002"],choices:[{text:"\u7acb\u5373\u524d\u5f80\u6642\u9418\u5854\uff0c\u770b\u770b\u5348\u591c\u6709\u4ec0\u9ebc\u5728\u7b49\u5f85\u3002",choiceId:"to_clock_tower"},{text:"\u5148\u4ed4\u7d30\u8abf\u67e5\u683c\u96f7\u68ee\u535a\u58eb\u7684\u5be6\u9a57\u5ba4\uff0c\u5c0b\u627e\u66f4\u591a\u96b1\u85cf\u7dda\u7d22\u3002",choiceId:"investigate_lab_thoroughly"},{text:"\u56de\u5230\u8fa6\u516c\u5ba4\uff0c\u7814\u7a76\u683c\u96f7\u68ee\u535a\u58eb\u7684\u80cc\u666f\u8cc7\u6599\u548c\u300c\u6642\u9593\u6a5f\u68b0\u300d\u7684\u7406\u8ad6\u3002",choiceId:"research_grayson_background"}]},A="undefined"!==typeof __app_id?__app_id:"default-app-id";Object(a.useEffect)(()=>{console.log("Firebase init useEffect triggered.");try{const t="undefined"!==typeof window.__firebase_config?window.__firebase_config:"{}";let n={};try{n=JSON.parse(t)}catch(e){return console.error("Failed to parse Firebase config JSON:",e),O("Firebase \u914d\u7f6e\u683c\u5f0f\u932f\u8aa4\u3002\u61c9\u7528\u7a0b\u5f0f\u529f\u80fd\u53d7\u9650\u3002"),m("\u7121\u6cd5\u521d\u59cb\u5316 Firebase"),void y(!0)}if(console.log("Firebase config:",n),0===Object.keys(n).length||!n.apiKey||!n.authDomain||!n.projectId)return console.error("Firebase config is empty or missing critical keys (apiKey, authDomain, projectId). Firebase will not be initialized."),O("Firebase \u914d\u7f6e\u70ba\u7a7a\u6216\u7f3a\u5c11\u95dc\u9375\u91d1\u9470 (apiKey, authDomain, projectId)\u3002\u61c9\u7528\u7a0b\u5f0f\u529f\u80fd\u53d7\u9650\u3002"),m("\u7121\u6cd5\u521d\u59cb\u5316 Firebase"),void y(!0);const a=Object(i.a)(n),c=Object(l.a)(a),o=Object(d.d)(a);f(c),h(o),console.log("Firebase app, auth, db instances set."),Object(l.b)(c,async e=>{var t;if(console.log("onAuthStateChanged triggered. User:",e),!e)try{console.log("No user signed in. Attempting sign-in...");const e="undefined"!==typeof window.__initial_auth_token?window.__initial_auth_token:"";e?(console.log("Signing in with custom token."),await Object(l.d)(c,e)):(console.log("Signing in anonymously."),await Object(l.c)(c)),console.log("Sign-in attempt finished.")}catch(w){console.error("Firebase authentication failed:",w),O("Firebase \u8a8d\u8b49\u5931\u6557: ".concat(w.message,". \u90e8\u5206\u529f\u80fd\u53ef\u80fd\u53d7\u9650\u3002"))}const n=(null===(t=c.currentUser)||void 0===t?void 0:t.uid)||"\u533f\u540d\u7528\u6236";console.log("Setting userId:",n),m(n),console.log("Setting isAuthReady to true."),y(!0)})}catch(w){console.error("Failed to initialize Firebase:",w),O("Firebase \u521d\u59cb\u5316\u5931\u6557: ".concat(w.message,". \u8acb\u6aa2\u67e5\u63a7\u5236\u53f0\u3002")),y(!0)}},[]);const D=Object(a.useCallback)(async()=>{if(!b||!p||!p.currentUser)return O("\u7121\u6cd5\u8f09\u5165\u9032\u5ea6\uff1a\u672a\u767b\u5165\u3002"),!1;C(!0),I("\u6b63\u5728\u8f09\u5165\u9032\u5ea6..."),O(null);const e=p.currentUser.uid,n=Object(d.b)(b,"artifacts/".concat(A,"/users/").concat(e,"/saved_stories"),"main_story");try{const e=await Object(d.c)(n);if(e.exists()){const n=e.data();if(n.currentChapterState)return t(n.currentChapterState),o(n.currentChapterState.choices||[]),I("\u9032\u5ea6\u8f09\u5165\u6210\u529f\uff01"),!0}return I("\u6c92\u6709\u627e\u5230\u4fdd\u5b58\u7684\u9032\u5ea6\u3002"),!1}catch(a){return console.error("Error loading progress:",a),O("\u8f09\u5165\u9032\u5ea6\u5931\u6557: ".concat(a.message)),I("\u8f09\u5165\u9032\u5ea6\u5931\u6557\uff01"),!1}finally{C(!1),setTimeout(()=>I(""),3e3)}},[b,p,A]);Object(a.useEffect)(()=>{(async()=>{if(x&&b&&p&&"\u8f09\u5165\u4e2d..."!==g){C(!0),I("\u6b63\u5728\u8f09\u5165\u60a8\u7684\u9032\u5ea6...");const e=await D();C(!1),e?I("\u9032\u5ea6\u8f09\u5165\u6210\u529f\uff01"):(t(T),o(T.choices),I("\u6c92\u6709\u627e\u5230\u4fdd\u5b58\u7684\u9032\u5ea6\uff0c\u5f9e\u982d\u958b\u59cb\u3002")),setTimeout(()=>I(""),3e3)}else x&&!b&&(t(T),o(T.choices),I("Firebase \u672a\u521d\u59cb\u5316\uff0c\u7121\u6cd5\u8f09\u5165/\u4fdd\u5b58\u9032\u5ea6\u3002"),O(e=>e||"Firebase \u670d\u52d9\u4e0d\u53ef\u7528\uff0c\u90e8\u5206\u529f\u80fd\u53d7\u9650\u3002"))})()},[x,b,p,g,T,D]);const R=Object(a.useCallback)(e=>{let t="";const n=e=>e.replace(/[^a-zA-Z0-9_-]/g,"").toLowerCase();if(e&&e.chapterId&&"string"===typeof e.chapterId&&e.chapterId.length>0){const a=n(e.chapterId);a.length>0&&(t=a)}if(0===t.length&&e){let a=e.title?n(e.title):"",c=e.content&&e.content.length>0&&e.content[0]?n(e.content[0].substring(0,30)):"";a.length>0&&c.length>0?t="".concat(a,"_").concat(c):a.length>0?t=a:c.length>0&&(t=c)}return 0===t.length&&(t="auto_gen_chapter"),"".concat(t,"_").concat(Date.now())},[]);Object(a.useEffect)(()=>{(async()=>{if(!b||!e)return void k({});const t=R(e),n=Object(d.a)(b,"artifacts",A,"public","data","choice_stats"),a=Object(d.b)(n,t);console.log("DEBUG: Fetching stats from path:",a.path);try{const e=await Object(d.c)(a);if(e.exists()){const t=e.data(),n=t.totalSelectionsForChapter||0,a={};t.choices&&t.choices.forEach(e=>{a[e.choiceId]={count:e.totalCount,percentage:n>0?(e.totalCount/n*100).toFixed(1):0}}),k(a)}else k({})}catch(c){console.error("Error fetching choice stats:",c),k({})}})()},[b,e,A,R]);const U=(n,a)=>{(async(n,a)=>{if(u(!0),O(null),o([]),k({}),b&&e&&a){const t=R(e),c=Object(d.a)(b,"artifacts",A,"public","data","choice_stats"),o=Object(d.b)(c,t);console.log("DEBUG: Updating stats at path:",o.path);try{const t=await Object(d.c)(o);if(t.exists()){const e=t.data().choices||[];let c=!1;const r=e.map(e=>e.choiceId===a?(c=!0,Object(s.a)(Object(s.a)({},e),{},{totalCount:Object(d.e)(1)})):e);c||r.push({choiceId:a,text:n,totalCount:1}),await Object(d.g)(o,{choices:r,totalSelectionsForChapter:Object(d.e)(1),lastUpdated:new Date})}else{const t=e.choices.map(e=>({choiceId:e.choiceId,text:e.text,totalCount:0})),n=t.findIndex(e=>e.choiceId===a);-1!==n&&(t[n].totalCount=1),await Object(d.f)(o,{chapterTitle:e.title,chapterContentPreview:e.content[0].substring(0,Math.min(e.content[0].length,100)),choices:t,totalSelectionsForChapter:1,lastUpdated:new Date})}}catch(h){console.error("Error updating choice statistics:",h)}}const c=e?e.content.join("\n"):"",r="\n      \u4f60\u662f\u4e00\u500b\u4e92\u52d5\u5f0f\u5c0f\u8aaa\u7684\u4f5c\u8005\u3002\u8acb\u6839\u64da\u4ee5\u4e0b\u6545\u4e8b\u80cc\u666f\u548c\u8b80\u8005\u7684\u9078\u64c7\uff0c\u751f\u6210\u4e0b\u4e00\u7ae0\u7bc0\u7684\u5167\u5bb9\u3002\n      \u8acb\u78ba\u4fdd\u6545\u4e8b\u908f\u8f2f\u9023\u8cab\u3001\u5bcc\u6709\u5275\u610f\uff0c\u4e26\u5305\u542b\u4e00\u500b\u65b0\u7684\u9078\u64c7\u9ede\uff0c\u8b93\u8b80\u8005\u7e7c\u7e8c\u5f71\u97ff\u6545\u4e8b\u8d70\u5411\u3002\n      \n      \u6545\u4e8b\u80cc\u666f\uff08\u4e0a\u4e00\u7ae0\u7bc0\u5167\u5bb9\uff09\uff1a\n      ".concat(c,"\n\n      \u8b80\u8005\u7684\u9078\u64c7\u662f\uff1a\n      ").concat(n,'\n\n      \u8acb\u4ee5 JSON \u683c\u5f0f\u8fd4\u56de\u4e0b\u4e00\u7ae0\u7bc0\u7684\u6a19\u984c\u3001\u5167\u5bb9\uff08\u591a\u500b\u6bb5\u843d\u7d44\u6210\u7684\u9663\u5217\uff09\u548c\u65b0\u7684\u9078\u64c7\uff08\u6bcf\u500b\u9078\u64c7\u5305\u542b text \u548c\u4e00\u500b\u7c21\u77ed\u7684 choiceId\uff09\u3002\n      \u5982\u679c\u6545\u4e8b\u53ef\u4ee5\u7d50\u675f\uff0c\u5247 choices \u9663\u5217\u70ba\u7a7a\u3002\n\n      JSON \u683c\u5f0f\u7bc4\u4f8b\uff1a\n      {\n        "title": "\u65b0\u7ae0\u7bc0\u6a19\u984c",\n        "content": [\n          "\u7b2c\u4e00\u6bb5\u5167\u5bb9...",\n          "\u7b2c\u4e8c\u6bb5\u5167\u5bb9..."\n        ],\n        "choices": [\n          {"text": "\u9078\u64c7\u4e00\u7684\u6587\u5b57", "choiceId": "choice_id_1"},\n          {"text": "\u9078\u64c7\u4e8c\u7684\u6587\u5b57", "choiceId": "choice_id_2"}\n        ]\n      }\n    ');let i=[];i.push({role:"user",parts:[{text:r}]});const l={contents:i,generationConfig:{responseMimeType:"application/json",responseSchema:{type:"OBJECT",properties:{chapterId:{type:"STRING"},title:{type:"STRING"},content:{type:"ARRAY",items:{type:"STRING"}},choices:{type:"ARRAY",items:{type:"OBJECT",properties:{text:{type:"STRING"},choiceId:{type:"STRING"}},propertyOrdering:["text","choiceId"]}}},propertyOrdering:["chapterId","title","content","choices"]}}},g="undefined"!==typeof window.__api_key&&null!==window.__api_key?String(window.__api_key):"";console.log("Debug: Text API Key status (first 5 chars):",g?g.substring(0,5)+"...":"EMPTY/NOT_PROVIDED");const m="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=".concat(g);try{const e=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!e.ok)throw new Error("\u6587\u672c API \u8acb\u6c42\u5931\u6557\uff0c\u72c0\u614b\u78bc: ".concat(e.status));const n=await e.json();console.log("LLM Text Raw Result:",n);let a=null;if(n.candidates&&n.candidates.length>0&&n.candidates[0].content&&n.candidates[0].content.parts&&n.candidates[0].content.parts.length>0){const e=n.candidates[0].content.parts[0].text;a=JSON.parse(e),a.chapterId||(a.chapterId=R(a)),t(a),o(a.choices||[])}else O("LLM \u6587\u672c\u56de\u61c9\u683c\u5f0f\u4e0d\u6b63\u78ba\u6216\u5167\u5bb9\u7f3a\u5931\u3002"),t({title:"\u751f\u6210\u5931\u6557",content:["\u62b1\u6b49\uff0cAI \u5728\u751f\u6210\u4e0b\u4e00\u7ae0\u7bc0\u6587\u672c\u6642\u9047\u5230\u554f\u984c\u3002\u8acb\u91cd\u8a66\u6216\u9078\u64c7\u5176\u4ed6\u9078\u9805\u3002"],choices:[]}),o([]);u(!1)}catch(p){console.error("Error generating chapter:",p),O("\u751f\u6210\u7ae0\u7bc0\u6642\u767c\u751f\u932f\u8aa4: ".concat(p.message,". \u8acb\u6aa2\u67e5\u63a7\u5236\u53f0\u7372\u53d6\u66f4\u591a\u8a73\u7d30\u4fe1\u606f\u3002")),t({title:"\u751f\u6210\u5931\u6557",content:["\u62b1\u6b49\uff0cAI \u5728\u751f\u6210\u4e0b\u4e00\u7ae0\u7bc0\u6642\u9047\u5230\u554f\u984c\u3002\u8acb\u91cd\u8a66\u6216\u9078\u64c7\u5176\u4ed6\u9078\u9805\u3002"],choices:[]}),o([]),u(!1)}})(n,a)};return x?c.a.createElement("div",{className:"min-h-screen bg-gradient-to-br from-gray-100 to-gray-300 flex flex-col items-center p-4 sm:p-6"},c.a.createElement("div",{className:"w-full max-w-4xl text-right text-sm text-gray-600 mb-4"},"\u7528\u6236ID: ",c.a.createElement("span",{className:"font-mono text-blue-700 break-all"},g)),c.a.createElement("header",{className:"w-full max-w-4xl bg-white shadow-lg rounded-xl p-6 mb-8 text-center"},c.a.createElement("h1",{className:"text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2 font-inter"},"\u4e92\u52d5\u5f0f\u751f\u6210\u5c0f\u8aaa"),c.a.createElement("p",{className:"text-lg text-gray-600 font-inter"},"\u4f60\u7684\u9078\u64c7\uff0c\u69cb\u7bc9\u6545\u4e8b")),c.a.createElement("main",{className:"w-full max-w-4xl bg-white shadow-lg rounded-xl p-6 mb-8 flex-grow"},w&&c.a.createElement("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},c.a.createElement("strong",{className:"font-bold"},"\u932f\u8aa4!"),c.a.createElement("span",{className:"block sm:inline"}," ",w)),(_||E)&&c.a.createElement("div",{className:"mb-4 p-3 rounded-lg text-center font-semibold ".concat(_?"bg-green-100 text-green-700":"bg-blue-100 text-blue-700")},_||E),e&&c.a.createElement(c.a.Fragment,null,c.a.createElement("h2",{className:"text-3xl sm:text-4xl font-bold text-gray-800 mb-6 font-inter"},e.title),c.a.createElement("div",{className:"text-gray-700 leading-relaxed text-lg sm:text-xl font-inter"},e.content.map((e,t)=>c.a.createElement("p",{key:t,className:"mb-4"},e)))),r&&c.a.createElement("div",{className:"flex justify-center items-center py-8"},c.a.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-blue-500"}),c.a.createElement("p",{className:"ml-4 text-xl text-blue-600 font-semibold font-inter"},"AI \u6b63\u5728\u751f\u6210\u4e0b\u4e00\u7ae0\u7bc0\u6587\u672c...")),!r&&n.length>0&&c.a.createElement("div",{className:"mt-8 pt-6 border-t-2 border-gray-200"},c.a.createElement("h3",{className:"text-2xl font-bold text-gray-800 mb-4 font-inter"},"\u4f60\u7684\u9078\u64c7\uff1a"),c.a.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},n.map((e,t)=>{const n=F[e.choiceId],a=n?n.percentage:0;return c.a.createElement("button",{key:t,onClick:()=>U(e.text,e.choiceId),className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 text-lg font-inter flex justify-between items-center"},c.a.createElement("span",null,e.text),n&&c.a.createElement("span",{className:"ml-4 text-sm bg-blue-700 px-2 py-1 rounded-full"},a,"%"))}))),!r&&0===n.length&&e&&c.a.createElement("div",{className:"mt-8 pt-6 border-t-2 border-gray-200 text-center text-xl text-gray-600 font-inter"},"\u6545\u4e8b\u66ab\u6642\u544a\u4e00\u6bb5\u843d\uff0c\u6216\u8005\u5df2\u5230\u9054\u7d50\u5c40\u3002\u611f\u8b1d\u4f60\u7684\u53c3\u8207\uff01")),c.a.createElement("div",{className:"w-full max-w-4xl bg-white shadow-lg rounded-xl p-4 mt-8 flex justify-center gap-4"},c.a.createElement("button",{onClick:async()=>{if(!b||!p||!p.currentUser||!e)return void O("\u7121\u6cd5\u4fdd\u5b58\u9032\u5ea6\uff1a\u672a\u767b\u5165\u6216\u7121\u7576\u524d\u7ae0\u7bc0\u6578\u64da\u3002");S(!0),j("\u6b63\u5728\u4fdd\u5b58\u9032\u5ea6..."),O(null);const t=p.currentUser.uid,n=Object(d.b)(b,"artifacts/".concat(A,"/users/").concat(t,"/saved_stories"),"main_story");try{await Object(d.f)(n,{currentChapterState:e,lastSavedAt:new Date},{merge:!0}),j("\u9032\u5ea6\u4fdd\u5b58\u6210\u529f\uff01")}catch(a){console.error("Error saving progress:",a),O("\u4fdd\u5b58\u9032\u5ea6\u5931\u6557: ".concat(a.message)),j("\u9032\u5ea6\u4fdd\u5b58\u5931\u6557\uff01")}finally{S(!1),setTimeout(()=>j(""),3e3)}},disabled:N||v||!p||!p.currentUser||!e,className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300 text-lg font-inter disabled:opacity-50 disabled:cursor-not-allowed"},N?"\u6b63\u5728\u4fdd\u5b58...":"\u4fdd\u5b58\u9032\u5ea6"),c.a.createElement("button",{onClick:D,disabled:v||N||!p||!p.currentUser,className:"bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-300 text-lg font-inter disabled:opacity-50 disabled:cursor-not-allowed"},v?"\u6b63\u5728\u8f09\u5165...":"\u8f09\u5165\u9032\u5ea6")),c.a.createElement("footer",{className:"w-full max-w-4xl text-center text-gray-600 mt-8"},c.a.createElement("p",{className:"text-sm font-inter"},"Powered by AI Generative Models & Your Imagination."))):c.a.createElement("div",{className:"flex items-center justify-center min-h-screen bg-gray-100"},c.a.createElement("div",{className:"text-lg font-semibold text-gray-700 font-inter"},"\u6b63\u5728\u8f09\u5165\u4ecb\u9762..."))};var g=e=>{e&&e instanceof Function&&n.e(3).then(n.bind(null,31)).then(t=>{let{getCLS:n,getFID:a,getFCP:c,getLCP:o,getTTFB:r}=t;n(e),a(e),c(e),o(e),r(e)})};r.a.createRoot(document.getElementById("root")).render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(u,null))),g()}},[[16,1,2]]]);
//# sourceMappingURL=main.dbc9c5ef.chunk.js.map